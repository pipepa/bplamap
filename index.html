<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>–û–±–≤–µ–¥–µ–Ω–Ω—è –æ–±–ª–∞—Å—Ç–µ–π –£–∫—Ä–∞—ó–Ω–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: #121212; }
    #map { height: 100vh; width: 100vw; }

    .leaflet-popup-content button {
      margin: 5px 0;
      padding: 5px 10px;
      background: #333;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .leaflet-popup-content button:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <!-- –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
  <div id="controlPanel" style="position: absolute; top: 10px; right: 10px; background: #222; padding: 10px; border-radius: 8px; z-index: 1000; color: white; font-family: sans-serif;">
    <h4 style="margin: 0 0 10px 0;">–ö–µ—Ä—É–≤–∞–Ω–Ω—è –æ–±–ª–∞—Å—Ç—è–º–∏</h4>
    <button onclick="clearAllHighlights()" style="background: #d32f2f; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ</button><br>
    <button onclick="highlightAll()" style="background: #1976d2; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üî¥ –û–±–≤–µ—Å—Ç–∏ –≤—Å—ñ</button><br>
    <button onclick="toggleDrawingMode()" style="background: #388e3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">‚úèÔ∏è –ú–∞–ª—é–≤–∞—Ç–∏ –æ–±–ª–∞—Å—Ç—å</button><br>
    <button onclick="clearDrawnAreas()" style="background: #7b1fa2; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è</button><br>
    <button onclick="highlightSpecific('–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞')" style="background: #ff5722; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üìç –ü–æ–ª—Ç–∞–≤—Å—å–∫–∞</button><br>
    <button onclick="highlightSpecific('–ö–∏—ó–≤—Å—å–∫–∞')" style="background: #ff9800; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üìç –ö–∏—ó–≤—Å—å–∫–∞</button><br>
    <button onclick="highlightSpecific('–õ—å–≤—ñ–≤—Å—å–∫–∞')" style="background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üìç –õ—å–≤—ñ–≤—Å—å–∫–∞</button><br>
    <button onclick="highlightSpecific('–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞')" style="background: #9c27b0; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üìç –•–∞—Ä–∫—ñ–≤—Å—å–∫–∞</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script>
    const map = L.map('map').setView([49.0, 31.0], 6);

    // –¢–µ–º–Ω–∞ –∫–∞—Ä—Ç–∞
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CartoDB',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);

    // –ó–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ –≤–∏–¥—ñ–ª–µ–Ω—ñ –æ–±–ª–∞—Å—Ç—ñ
    const selectedLayers = new Map();

    // –î–∞–Ω—ñ –æ–±–ª–∞—Å—Ç–µ–π –£–∫—Ä–∞—ó–Ω–∏ (–≤–±—É–¥–æ–≤–∞–Ω—ñ –≤ –∫–æ–¥)
    const ukraineRegions = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {
            "name": "–ö–∏—ó–≤—Å—å–∫–∞"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [29.5, 50.5], [30.5, 50.5], [30.5, 51.5], [29.5, 51.5], [29.5, 50.5]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [32.5, 48.5], [34.5, 48.5], [34.5, 50.5], [32.5, 50.5], [32.5, 48.5]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "–õ—å–≤—ñ–≤—Å—å–∫–∞"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [22.5, 48.5], [25.5, 48.5], [25.5, 50.5], [22.5, 50.5], [22.5, 48.5]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [35.5, 48.5], [37.5, 48.5], [37.5, 50.5], [35.5, 50.5], [35.5, 48.5]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [33.5, 47.5], [36.5, 47.5], [36.5, 49.5], [33.5, 49.5], [33.5, 47.5]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "–û–¥–µ—Å—å–∫–∞"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [28.5, 45.5], [31.5, 45.5], [31.5, 47.5], [28.5, 47.5], [28.5, 45.5]
            ]]
          }
        }
      ]
    };

    // –î–æ–¥–∞—î–º–æ –æ–±–ª–∞—Å—Ç—ñ –Ω–∞ –∫–∞—Ä—Ç—É
    L.geoJSON(ukraineRegions, {
      style: {
        color: "#666",
        weight: 1,
        fillOpacity: 0.1
      },
      onEachFeature: function (feature, layer) {
        const name = feature.properties?.name || "–û–±–ª–∞—Å—Ç—å";

        layer.on('click', function (e) {
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–≤–æ–¥–∏–º–æ –æ–±–ª–∞—Å—Ç—å –ø—Ä–∏ –∫–ª—ñ–∫—É
          highlight(name);
          
          const popup = `
            <strong>${name}</strong><br/>
            <button onclick="highlight('${name}')">üî¥ –û–±–≤–µ—Å—Ç–∏</button><br/>
            <button onclick="unhighlight('${name}')">‚ö™ –ó–Ω—è—Ç–∏ –æ–±–≤–µ–¥–µ–Ω–Ω—è</button>
          `;
          layer.bindPopup(popup).openPopup();
        });

        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —à–∞—Ä
        selectedLayers.set(feature.properties.name, layer);
      }
    }).addTo(map);

    // –û–±–≤–µ—Å—Ç–∏ –æ–±–ª–∞—Å—Ç—å
    window.highlight = function (name) {
      const layer = selectedLayers.get(name);
      if (layer) {
        layer.setStyle({
          color: "red",
          weight: 3,
          fillColor: "red",
          fillOpacity: 0.3
        });
        layer.closePopup();
      }
    };

    // –ó–Ω—è—Ç–∏ –æ–±–≤–µ–¥–µ–Ω–Ω—è
    window.unhighlight = function (name) {
      const layer = selectedLayers.get(name);
      if (layer) {
        layer.setStyle({
          color: "#666",
          weight: 1,
          fillColor: "#000",
          fillOpacity: 0.1
        });
        layer.closePopup();
      }
    };

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –æ–±–≤–µ–¥–µ–Ω–Ω—è
    window.clearAllHighlights = function () {
      selectedLayers.forEach((layer, name) => {
        layer.setStyle({
          color: "#666",
          weight: 1,
          fillColor: "#000",
          fillOpacity: 0.1
        });
      });
    };

    // –û–±–≤–µ—Å—Ç–∏ –≤—Å—ñ –æ–±–ª–∞—Å—Ç—ñ
    window.highlightAll = function () {
      selectedLayers.forEach((layer, name) => {
        layer.setStyle({
          color: "red",
          weight: 3,
          fillColor: "red",
          fillOpacity: 0.3
        });
      });
    };

    // –†–µ–∂–∏–º –º–∞–ª—é–≤–∞–Ω–Ω—è
    let drawingMode = false;
    let drawingLayer = null;

    window.toggleDrawingMode = function () {
      drawingMode = !drawingMode;
      const button = document.querySelector('button[onclick="toggleDrawingMode()"]');
      
      if (drawingMode) {
        button.style.background = '#f57c00';
        button.textContent = '‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è';
        startDrawing();
      } else {
        button.style.background = '#388e3c';
        button.textContent = '‚úèÔ∏è –ú–∞–ª—é–≤–∞—Ç–∏ –æ–±–ª–∞—Å—Ç—å';
        stopDrawing();
      }
    };

    function startDrawing() {
      if (!drawingLayer) {
        drawingLayer = L.layerGroup().addTo(map);
      }
      
      map.on('click', onMapClick);
    }

    function stopDrawing() {
      map.off('click', onMapClick);
    }

    function onMapClick(e) {
      if (!drawingMode) return;
      
      const marker = L.marker(e.latlng, {
        icon: L.divIcon({
          className: 'drawing-marker',
          html: '<div style="background: red; width: 8px; height: 8px; border-radius: 50%; border: 2px solid white;"></div>',
          iconSize: [12, 12]
        })
      }).addTo(drawingLayer);
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ—á–∫–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—É
      if (!window.drawingPoints) {
        window.drawingPoints = [];
      }
      window.drawingPoints.push(e.latlng);
      
      // –Ø–∫—â–æ —î –±—ñ–ª—å—à–µ 2 —Ç–æ—á–æ–∫, –º–∞–ª—é—î–º–æ –ø–æ–ª—ñ–≥–æ–Ω
      if (window.drawingPoints.length >= 3) {
        const polygon = L.polygon(window.drawingPoints, {
          color: 'red',
          weight: 3,
          fillColor: 'red',
          fillOpacity: 0.3
        }).addTo(drawingLayer);
      }
    }

    // –û—á–∏—Å—Ç–∏—Ç–∏ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω—ñ –æ–±–ª–∞—Å—Ç—ñ
    window.clearDrawnAreas = function () {
      if (drawingLayer) {
        drawingLayer.clearLayers();
      }
      window.drawingPoints = [];
    };

    // –®–≤–∏–¥–∫–∏–π –≤–∏–±—ñ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ
    window.highlightSpecific = function (regionName) {
      // –°–ø–æ—á–∞—Ç–∫—É –æ—á–∏—â–∞—î–º–æ –≤—Å—ñ –æ–±–≤–µ–¥–µ–Ω–Ω—è
      clearAllHighlights();
      
      // –ü–æ—Ç—ñ–º –æ–±–≤–æ–¥–∏–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –æ–±–ª–∞—Å—Ç—å
      const layer = selectedLayers.get(regionName);
      if (layer) {
        layer.setStyle({
          color: "red",
          weight: 3,
          fillColor: "red",
          fillOpacity: 0.3
        });
        
        // –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–∞—Ä—Ç—É –Ω–∞ –≤–∏–±—Ä–∞–Ω—ñ–π –æ–±–ª–∞—Å—Ç—ñ
        map.fitBounds(layer.getBounds());
      }
    };
  </script>
</body>
</html>
