<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>–û–±–≤–µ–¥–µ–Ω–Ω—è –æ–±–ª–∞—Å—Ç–µ–π –£–∫—Ä–∞—ó–Ω–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: #121212; }
    #map { height: 100vh; width: 100vw; }

    .leaflet-popup-content button {
      margin: 5px 0;
      padding: 5px 10px;
      background: #333;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .leaflet-popup-content button:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <!-- –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
  <div id="controlPanel" style="position: absolute; top: 10px; right: 10px; background: #222; padding: 10px; border-radius: 8px; z-index: 1000; color: white; font-family: sans-serif;">
    <h4 style="margin: 0 0 10px 0;">–ö–µ—Ä—É–≤–∞–Ω–Ω—è –æ–±–ª–∞—Å—Ç—è–º–∏</h4>
    <button onclick="clearAllHighlights()" style="background: #d32f2f; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ</button><br>
    <button onclick="highlightAll()" style="background: #1976d2; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üî¥ –û–±–≤–µ—Å—Ç–∏ –≤—Å—ñ</button><br>
    <button onclick="toggleDrawingMode()" style="background: #388e3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">‚úèÔ∏è –ú–∞–ª—é–≤–∞—Ç–∏ –æ–±–ª–∞—Å—Ç—å</button><br>
    <button onclick="clearDrawnAreas()" style="background: #7b1fa2; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin: 2px;">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-ajax"></script> <!-- –¥–ª—è –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON -->
  <script>
    const map = L.map('map').setView([49.0, 31.0], 6);

    // –¢–µ–º–Ω–∞ –∫–∞—Ä—Ç–∞
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CartoDB',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);

    // –ó–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ –≤–∏–¥—ñ–ª–µ–Ω—ñ –æ–±–ª–∞—Å—Ç—ñ
    const selectedLayers = new Map();

    // –ü—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –æ–±–ª–∞—Å—Ç—ñ –∑ GeoJSON
    fetch('https://raw.githubusercontent.com/deldersveld/topojson/master/countries/ukraine/ukr-admin1.geojson')
      .then(response => response.json())
      .then(data => {
        L.geoJSON(data, {
          style: {
            color: "#666",
            weight: 1,
            fillOpacity: 0.1
          },
          onEachFeature: function (feature, layer) {
            const name = feature.properties?.name || "–û–±–ª–∞—Å—Ç—å";

            layer.on('click', function (e) {
              const popup = `
                <strong>${name}</strong><br/>
                <button onclick="highlight('${name}')">üî¥ –û–±–≤–µ—Å—Ç–∏</button><br/>
                <button onclick="unhighlight('${name}')">‚ö™ –ó–Ω—è—Ç–∏ –æ–±–≤–µ–¥–µ–Ω–Ω—è</button>
              `;
              layer.bindPopup(popup).openPopup();
            });

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —à–∞—Ä
            selectedLayers.set(feature.properties.name, layer);
          }
        }).addTo(map);
      });

    // –û–±–≤–µ—Å—Ç–∏ –æ–±–ª–∞—Å—Ç—å
    window.highlight = function (name) {
      const layer = selectedLayers.get(name);
      if (layer) {
        layer.setStyle({
          color: "red",
          weight: 3,
          fillColor: "red",
          fillOpacity: 0.3
        });
        layer.closePopup();
      }
    };

    // –ó–Ω—è—Ç–∏ –æ–±–≤–µ–¥–µ–Ω–Ω—è
    window.unhighlight = function (name) {
      const layer = selectedLayers.get(name);
      if (layer) {
        layer.setStyle({
          color: "#666",
          weight: 1,
          fillColor: "#000",
          fillOpacity: 0.1
        });
        layer.closePopup();
      }
    };

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –æ–±–≤–µ–¥–µ–Ω–Ω—è
    window.clearAllHighlights = function () {
      selectedLayers.forEach((layer, name) => {
        layer.setStyle({
          color: "#666",
          weight: 1,
          fillColor: "#000",
          fillOpacity: 0.1
        });
      });
    };

    // –û–±–≤–µ—Å—Ç–∏ –≤—Å—ñ –æ–±–ª–∞—Å—Ç—ñ
    window.highlightAll = function () {
      selectedLayers.forEach((layer, name) => {
        layer.setStyle({
          color: "red",
          weight: 3,
          fillColor: "red",
          fillOpacity: 0.3
        });
      });
    };

    // –†–µ–∂–∏–º –º–∞–ª—é–≤–∞–Ω–Ω—è
    let drawingMode = false;
    let drawingLayer = null;

    window.toggleDrawingMode = function () {
      drawingMode = !drawingMode;
      const button = document.querySelector('button[onclick="toggleDrawingMode()"]');
      
      if (drawingMode) {
        button.style.background = '#f57c00';
        button.textContent = '‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è';
        startDrawing();
      } else {
        button.style.background = '#388e3c';
        button.textContent = '‚úèÔ∏è –ú–∞–ª—é–≤–∞—Ç–∏ –æ–±–ª–∞—Å—Ç—å';
        stopDrawing();
      }
    };

    function startDrawing() {
      if (!drawingLayer) {
        drawingLayer = L.layerGroup().addTo(map);
      }
      
      map.on('click', onMapClick);
    }

    function stopDrawing() {
      map.off('click', onMapClick);
    }

    function onMapClick(e) {
      if (!drawingMode) return;
      
      const marker = L.marker(e.latlng, {
        icon: L.divIcon({
          className: 'drawing-marker',
          html: '<div style="background: red; width: 8px; height: 8px; border-radius: 50%; border: 2px solid white;"></div>',
          iconSize: [12, 12]
        })
      }).addTo(drawingLayer);
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ—á–∫–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—É
      if (!window.drawingPoints) {
        window.drawingPoints = [];
      }
      window.drawingPoints.push(e.latlng);
      
      // –Ø–∫—â–æ —î –±—ñ–ª—å—à–µ 2 —Ç–æ—á–æ–∫, –º–∞–ª—é—î–º–æ –ø–æ–ª—ñ–≥–æ–Ω
      if (window.drawingPoints.length >= 3) {
        const polygon = L.polygon(window.drawingPoints, {
          color: 'red',
          weight: 3,
          fillColor: 'red',
          fillOpacity: 0.3
        }).addTo(drawingLayer);
      }
    }

    // –û—á–∏—Å—Ç–∏—Ç–∏ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω—ñ –æ–±–ª–∞—Å—Ç—ñ
    window.clearDrawnAreas = function () {
      if (drawingLayer) {
        drawingLayer.clearLayers();
      }
      window.drawingPoints = [];
    };
  </script>
</body>
</html>
